

### Running an experiment

#### Cleaning the chamber

It should take 20-40 minutes to disassemble, clean, and re-assemble the chamber.

1. Disassemble chamber.

    - Take off ceiling and dump / blow flies into a fly morgue.

    - Set aside ceiling, only handling it by the edges. The less stuff that
      comes into contact with the electrodes, the better.

    - Take out all screws.

      - Use 3/32" hex bit in screwdriver to remove button cap screws on the
        sides. The orange toggle switch near the trigger on the screwdriver
        switches the direction.

      - Use 7/64" hex hand driver to remove screws holding the ceiling rails
        down, and the two screws holding the floor circuit board down.

    - Do not take any of the layers apart until the cleaning step.


2. Clean all surfaces that touched the fly with DI water, and all surfaces with
   70% ethanol, diluted with DI water if diluted from a higher concentration.

    - Wear gloves.

    - Do water, then ethanol.

    - Use 1 Kimwipe per solvent per layer to clean. For layers with two parts,
      use one Kimwipe for both parts.

    - Use water on both circuit boards, and the middle third of both the yellow
      and white layers.

    - After cleaning with the water, particularly on the circuit boards, dry
      with another Kimwipe, as pooling of water on the circuit boards could
      damage them.

    - For the circuit boards, wipe with the long axis of the electrodes, to
      minimize risk of delaminating the circuit board.

    - When cleaning the white and yellow layers, try to wipe in the direction of
      the grooves, to minimize how much you shred the Kimwipes. Chunks of
      Kimwipe could interfere with a seal or provide a texture that could
      distract the flies from the task.

    - Clean both sides of each layer, except for the clear acrylic layers. For
      the top acrylic, only clean the bottom, and for the bottom acrylic
      baseplate, you only need to clean the top.

    - Let all parts dry, such that there is no water or ethanol remaining in the
      assembled chamber.

    - Since the Viton (black) layers might not dry well if you let them form a
      seal against the counter top, place each of those parts on a Kimwipe
      to help make sure the bottom can dry as well.


3. Re-assemble chamber

    - Do your best to line the floor circuit board up so that it seems to sit as
      symmetrically as possible with the rest of the geometry of the chamber,
      and that its holes line up well with those of the baseplate.

    - Use two 3/16" long 6-32 screws (the smallest screws of the assembly) to
      secure opposite corners of the floor circuit board. To the sides of either
      spring loaded connector on this circuit board, there should be two holes,
      use one of each of these holes, and not the holes in the parallel lines
      down the side of the board.

    - Line up the thicker two black Viton layers against the sides of the
      circuit board. **There should not be a gap between the circuit board and
      the Viton, as air could escape out the sides if there were.** Place just a
      small amount of the Viton against the acrylic baseplate, and then slide
      the gasket towards the circuit board, paying the most attention to the
      interface between the circuit board and the gasket, but also trying to
      line up the holes in the gasket with the holes in the mounting plate.
      Since the Viton is kind of sticky once much of it is layed flat, if you
      make a mistake, it is often easier to just list the whole thing up to try
      re-aligning it.

        - Holes are symmetric, but there is more material on one side than the
          other. Place in the orientation that centers it best on the baseplate.
          By flipping the gasket over, it could also work just as well on the
          other side.

    - Place down the yellow shimstock layer down. All holes and slots should
      match something on the layers below, and the edges should roughly line up
      with the edges of the Viton. If this layer is not laying flat, lift it up
      and try placing it back down.

    - Place down the white Delrin layer. There are a few holes and slots that
      are in the yellow layer, that are not in the white layer, but all holes
      are that are in the white layer should match holes in the yellow layer.

        - Alignment between the white and layers is not critical at this point.
          You can fix that alignment just before screwing the whole assemble
          together, as the two materials slide against each other easily.

    - Place down the thinner top Viton gaskets, just doing your best to align
      the holes with the white layer beneath.

        - Same note on symmetry / orientation as with the thicker Viton gaskets.

    - Now place the top acrylic sides on.
    
        - Since both the acrylic and the white layers stick the the Viton, you
          will need to get the acrylic in the orientation you want before
          placing it on the Viton, as you will likely not be able to slide the
          acrylic against the Viton once it is placed.

        - You can use the inside edges of the Viton to guide the placement of
          the acrylic along that dimension, but all other edges will extend
          slightly beyond the Viton, so they will not be useful for alignment.
          Ultimately, it is just important that the alignment of all the holes
          is OK between these two layers, just enough so you can get a screw
          through.

        - Same note on symmetry / orientation as with the Viton layers.

    - Push all the 5/8" long 8-32 button head screws into the holes.

        - You should not have to force them, but it is normal for there to be a
          little resistance pushing them into the holes, if the layers are
          slightly misaligned as the Viton is rubbing against the screw.

    - Tighten the screws down, after re-adjusting alignment between the white
      and yellow layers.

      - If available, put the clutch torque limiter on the lowest
        torque setting, and put in each screw until the limiter engages.

      - Try to use a consistent speed with the screwdriver, though it likely
        does not matter much.

      - Either start from one side or start from the center and work outwards.

    - Place the ceiling back on, such that the slightly shorter contact section
      (~11.5mm vs ~13.5mm) is closest to the side of the floor circuit board
      with the large 25 pin D-sub connector.

        - If the ceiling has already been used for a while, the longer contact
          should have deeper grooves from sliding wear with the contacts on the
          floor circuit board.

        - The reason for this, is that this shorter contact stops just short of
          riding up onto the gold spring-loaded connector during the loading
          process, and if it were not as short as it is, this position would
          line one set of vent holes up with the chambers, so flies could
          escape.

        - Place white Delrin rails and secure with 2 to 3 1/2" long 6-32 screws
          per rail. Place the screws such that, when the ceiling is in its
          final position, with all electrodes centered and each contact engaged
          with one set of spring connectors, the screws are next to part of the
          wider part of the ceiling, and not further out, toward the contacts.

          - This is because the rails will warp, not applying consistent
            pressure, if they aren't pushing directly down on the main flat edge
            of the ceiling.

4. Load the flies.

    - Prepare any odor dilutions before this step, and have the odor vials in
      the vial holders, just disconnected from the valves. You may connect the
      vial outlets to the odor manifold at this point if you'd like.

    - Set the chamber on a flat surface in front of you, oriented so the 25 pin
      D-sub connector is away from you.

    - Tighten the rail screws down as far as you can, such that the ceiling can
      slide back and forth along its long axis without much friction.

      In the topmost position, the shorter contact should stop against the side
      of the top spring-loaded connector, without sliding up on to it. If it
      slides up onto it, then the two rail screws closest to that connector
      should probably be a little tighter.

      The bottom ceiling contact should be depressing the bottom spring
      loaded connector just slightly. No space around the edge of the board
      should be wide enough for a fly to escape, but if there is only space
      along the bottom edge, and the you start from the top, you can leave the
      bottom screws a little loose until you get to the bottom, which will
      extend the life of the bottom contact slightly.

    - Starting from the top, use a fly aspirator to load flies into the
      chambers, one at a time, using the following motion:

      - Suck a fly into your aspirator. If you are only using one gender, and
        you have not already sorted your flies by sex, determine the gender of
        your fly before deciding whether to reject (into a morgue or back into
        the vial) or use the fly. Try to only use as much suction as is
        necessary, because too much could damage the fly.

      - Line up your aspirator with the top hole of the chamber you want to
        load. Apply suction, as necessary, to keep the fly out of the vent hole
        until you are ready to load the fly.

      - When you are ready to load the fly, quickly slide the ceiling towards
        you until the far set of vent holes lines up with the chambers, just
        enough so that a fly can fit through the space. **This step and the next
        two must be performed quickly, so as to not let any flies that have
        already been loaded escape.**

        - It sometimes helps to watch the flies that have already been loaded to
          wait until they are away from the vent holes, to minimize the chance
          of them escaping when you load the next fly.

        - If you slide the ceiling down too far, the top fly might escape from
          the extra space you create.

      - Blow your fly in to the chamber, tapping the aspirator against the hole
        if the fly is stuck to some internal surface of the aspirator.

      - Quickly slide the ceiling back up into position, preventing any flies
        from escaping.

    - Once you have loaded all your flies, tighten the screws a little further,
      so that the flies will not be able to escape as your adjust the ceiling in
      the next step.

    - Use a screwdriver or other instrument to gently lift up the top ceiling
      contact from the edge, and push the ceiling board up onto the top
      spring-loaded connector. **Try not to damage the contact when doing so.**

    - Tighten down the rail screws to a little past finger tight. You are ready
      to load the chamber into the box now.


4. Setting up for the experiment.

    - Connect the outlets of the high flow mass flow controllers to the inlets
      on the humidifier bottles, if they are not already connected.

    - Place your odor vials in the odor vial holders, and connect their outlets
      to the odor inlet manifold, if they are not already.

      - **Be careful with the Luer input connectors on the odor manifold, as the
        threads are not deep enough to avoid stripping on their own.** You may
        need to brace these connectors with either your finger or some pliers /
        hemostats.

    - Place the loaded chamber into the box.
    
      - Tilt one side up (alternate to reduce side bias this may introduce),
      
      - Rest the down-tilted side against one of the support rails.
      
      - Lift the odor inlet tubing on the up-tilted side with your other hand,
        and rest the previously up-tilted side down on the support rail, with
        the odor inlet tubing out of the way. Then release the odor inlet
        tubing.

      - Connect the two odor inlet Luer locks to the Luer locks on the chamber.

      - Connect the D-sub connector from the shock delivery electronics to the
        D-sub connector on the chamber.

      - Close the chamber, by draping a darkout cloth over the front or
        any openings. Tuck the darkout cloth in by the sides of the box, taking
        car that it is not kinking or putting much pressure on any of the odor 
        tubing.

      - Just before you are ready to start your experiment, enable the power
        supply, by pressing the enable button on the left. A green LED should go
        on. **From this point on, take special care not to touch any of the
        electronics dealing with the shock delivery.** No LEDs indicating
        overcurrent / other fault conditions should go on.

      - See the main README in this repository for instructions on running the
        software.
